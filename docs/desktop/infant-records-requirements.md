# デスクトップアプリ 乳児生活記録機能 要件定義書

## 1. 概要

### 1.1 目的
デスクトップアプリにおいて、0～2歳児の週次生活記録を管理・閲覧する機能を提供する。保育士が週単位で複数園児の記録を一覧表示し、効率的にデータを確認・編集できる管理画面を実現する。

### 1.2 対象ユーザー
- **保育士**: 0～2歳児クラスの担当保育士
- **役割**: 週次記録の閲覧、スタッフ入力データの編集、保護者入力データの確認

### 1.3 対象デバイス
- デスクトップPC (Windows/Mac)
- 推奨画面解像度: 1920×1080以上
- ブラウザ: Chrome, Edge, Safari (最新版)

---

## 2. 機能要件

### 2.1 週次マトリックスビュー

#### 2.1.1 画面構成
**ヘッダー部**:
- 画面タイトル: 「乳児生活記録 (0～2歳児)」
- 週選択コントロール: `[< 前週] 2026年1月4日～1月10日 [次週 >]`
- クラス選択ドロップダウン: 担当クラスのみ選択可能

**テーブル部**:
- 列ヘッダー: 「項目」列 + 日付列7つ (日曜日～土曜日)
- 行構成:
  - 大項目: 園児名 (【花子】【太郎】【悟】...)
  - 中項目: 〈家庭〉〈午前〉〈午後〉〈排泄〉
  - 小項目: 体温、様子、おやつ、機嫌、昼食、昼寝など

#### 2.1.2 表示項目

**〈家庭〉** (保護者入力 - 読取専用):
1. **体温**: 朝の体温 (例: `36.5℃ (8:30)`)
2. **様子**: 保護者からの申し送り (例: `元気です。朝食はよく食べました。`)

**〈午前〉** (スタッフ入力 - 編集可):
3. **体温**: 午前の体温 (例: `36.8℃ (10:00)`)
4. **おやつ**: 午前おやつの摂取量 (例: `完食`, `ほとんど`, `半分`, `少し`, `なし`)
5. **機嫌**: 午前の機嫌 (例: `良い`, `普通`, `悪い`, `泣いていた`)

**〈午後〉** (スタッフ入力 - 編集可):
6. **昼食**: 昼食の摂取量
7. **昼寝**: 昼寝の時間帯と睡眠時間 (例: `12:30-14:00 (90分)`)
8. **体温**: 午後の体温
9. **おやつ**: 午後おやつの摂取量
10. **機嫌**: 午後の機嫌

**〈排泄〉** (スタッフ入力 - 編集可):
11. **おしっこ**: 1日の総量 (例: `少量`, `普通`, `多量`)
12. **うんち**: 便の状態/色の形式 (例: `普通/普通`, `軟便/緑色`, `硬め/黒色`)
13. **おむつ交換**: 1日のオムツ交換回数 (例: `3回`, `5回`)

### 2.2 データの編集可否制御

#### 2.2.1 保護者入力データ (読取専用)
- 背景色: 薄い黄色 (#FFFBEB)
- アイコン: 🔒 (読取専用マーク)
- ホバー効果: なし
- クリック: 不可

#### 2.2.2 スタッフ入力データ (編集可)
- 背景色: 白 (#FFFFFF)
- ホバー効果: 薄い青背景 (#EFF6FF) + 青枠 (#3B82F6)
- クリック: 編集モーダル表示
- 未入力セル: 「未入力」と薄いグレーで表示

### 2.3 編集モーダル

#### 2.3.1 モーダルの表示タイミング
- スタッフ入力セルをクリックした時
- セルのdata属性から園児ID、日付、記録タイプを取得

#### 2.3.2 モーダルの構成
**ヘッダー**:
- タイトル: `編集: 花子さん - 1月5日(月)`
- 閉じるボタン (×)

**コンテンツ**:
- 記録タイプに応じたフォーム
  - **体温**: 電卓UI (数値ボタン0-9、小数点、クリア) + 時刻ピッカー
  - **食事**: ラジオボタン (完食/ほとんど/半分/少し/なし)
  - **昼寝**: 開始時刻・終了時刻ピッカー (睡眠時間は自動計算)
  - **機嫌**: ラジオボタン (良い/普通/悪い/泣いていた) + 備考テキストエリア
  - **排泄 (おしっこ)**: ラジオボタン (少なめ/普通/多め)
  - **排泄 (うんち)**: 便の状態 (普通/軟便/下痢/硬い) + 便の色 (通常/緑色/白色/黒色/血便)
  - **排泄 (オムツ)**: 数値入力 (0-20回)

**フッター**:
- [保存] ボタン (青)
- [キャンセル] ボタン (グレー)

### 2.4 週の切り替え

#### 2.4.1 前週/次週ボタン
- クリックで週を±7日移動
- 日曜日を週の開始日として固定
- データを再取得してテーブルを更新

#### 2.4.2 クラス切り替え
- ドロップダウンで担当クラスを選択
- クラス変更時にデータを再取得

---

## 3. 非機能要件

### 3.1 パフォーマンス
- 週次データ取得: 3秒以内
- セル編集モーダル表示: 0.5秒以内
- データ保存: 2秒以内

### 3.2 ユーザビリティ
- レスポンシブデザイン: 最小幅1280px
- 横スクロール対応: 項目列は固定、日付列はスクロール可能
- キーボード操作: Tab/Enter/Escでモーダル操作可能

### 3.3 アクセシビリティ
- WCAG 2.1 AA準拠
- スクリーンリーダー対応
- キーボードのみでの操作可能

---

## 4. ビジネスルール

### 4.1 データ表示の優先順位
1. **保護者入力データ**: 常に読取専用で表示
2. **スタッフ入力データ**: 編集可能だが、他のスタッフが入力したデータも表示

### 4.2 編集権限
- **保護者入力データ**: デスクトップアプリでは編集不可 (モバイルアプリから入力)
- **スタッフ入力データ**: 担当クラスのスタッフ全員が編集可能

### 4.3 データの一貫性
- 体温の異常フラグ: 37.5℃以上で自動設定 (将来機能)
- 昼寝の睡眠時間: 開始・終了時刻から自動計算
- オムツ交換回数: 0～20回の範囲で入力

### 4.4 週末・祝日の扱い
- 日曜日・土曜日も通常通り表示
- 園が休園日の場合は未入力として表示

---

## 5. 制約事項

### 5.1 既存システムとの連携
- モバイルアプリ (保護者・スタッフ) と同じデータベースを使用
- モバイルで入力されたデータをリアルタイムで反映 (ページリフレッシュ時)

### 5.2 対象年齢層の限定
- 0～2歳児のみが対象
- 3～5歳児は別途「連絡帳機能」で対応 (本要件の対象外)

### 5.3 データベース反映
- テーブルレイアウトは既存のスキーマを使用
- 新規テーブル作成は不要

---

## 6. データソース

### 6.1 使用するテーブル

| テーブル名 | 用途 |
|-----------|------|
| InfantTemperatures | 体温記録 (家庭・午前・午後) |
| ParentMorningNote | 保護者からの申し送り |
| InfantMeals | 食事記録 (おやつ・昼食) |
| InfantMoods | 機嫌記録 (午前・午後) |
| InfantSleeps | 昼寝記録 |
| InfantToileting | 排泄記録 (おしっこ・うんち・オムツ交換) |
| Children | 園児マスタ |
| Classes | クラスマスタ |

### 6.2 データ識別キー

**体温記録 (InfantTemperatures)**:
- MeasurementType = 'Home' → 家庭の体温
- MeasurementType = 'Morning' → 午前の体温
- MeasurementType = 'Afternoon' → 午後の体温
- CreatedByType = 'Parent' → 保護者入力 (読取専用)
- CreatedByType = 'Staff' → スタッフ入力 (編集可)

**食事記録 (InfantMeals)**:
- MealType = 'Breakfast' → 午前おやつ
- MealType = 'Lunch' → 昼食
- MealType = 'Snack' → 午後おやつ

**機嫌記録 (InfantMoods)**:
- MoodTime = 'Morning' → 午前の機嫌
- MoodTime = 'Afternoon' → 午後の機嫌

**排泄記録 (InfantToileting)**:
- 1日1レコード (主キー: NurseryId, ChildId, RecordDate)
- UrineAmount: おしっこの量 (Little/Normal/Lot)
- BowelCondition: 便の状態 (Normal/Soft/Diarrhea/Hard)
- BowelColor: 便の色 (Normal/Green/White/Black/Bloody)
- DiaperChangeCount: オムツ交換回数

---

## 7. 画面遷移

### 7.1 アクセス経路
```
デスクトップアプリ トップ
  ↓
スタッフダッシュボード
  ↓
[乳児生活記録] メニュー
  ↓
週次マトリックスビュー
```

### 7.2 画面内遷移
```
週次マトリックスビュー
  ↓ (セルクリック)
編集モーダル
  ↓ (保存)
週次マトリックスビュー (データ更新)
```

---

## 8. エラーハンドリング

### 8.1 データ取得失敗
- エラーメッセージ: 「データの取得に失敗しました。ネットワーク接続を確認してください。」
- リトライボタンを表示

### 8.2 データ保存失敗
- エラーメッセージ: 「保存に失敗しました。もう一度お試しください。」
- モーダルは閉じずに編集内容を保持

### 8.3 権限エラー
- エラーメッセージ: 「このクラスの記録を編集する権限がありません。」
- ログイン状態を確認

---

## 9. 今後の拡張予定

### 9.1 フェーズ2
- **印刷機能**: 週次記録をPDF出力
- **Excel出力**: 週次データをExcel形式でエクスポート
- **グラフ表示**: 体温・食事量・睡眠時間の推移グラフ

### 9.2 フェーズ3
- **複数週表示**: 4週分を並べて表示
- **一括編集機能**: 同じ値を複数セルに一括設定
- **コメント機能**: 各セルにコメントを追加

---

## 10. 関連ドキュメント

- [UI設計書](infant-records-ui-spec.md)
- [データベース仕様書](infant-records-database-spec.md)
- [モバイルアプリ 要件定義書](../mobile/requirements/infant-daily-records-requirements.md)
- [モバイルアプリ UI仕様書](../mobile/specifications/infant-daily-records-ui-spec.md)

---

## 11. 用語集

| 用語 | 説明 |
|------|------|
| 週次マトリックスビュー | 週単位で園児×日付のマトリックス形式で記録を表示する画面 |
| 大項目 | 園児名の行 |
| 中項目 | 家庭・午前・午後・排泄のカテゴリ行 |
| 小項目 | 体温・様子・おやつなどの個別記録項目 |
| 保護者入力データ | モバイルアプリから保護者が入力したデータ (読取専用) |
| スタッフ入力データ | モバイルまたはデスクトップから保育士が入力したデータ (編集可) |
| 編集モーダル | セルクリック時に表示される編集用ダイアログ |

---

## 12. 承認履歴

| 版数 | 日付 | 承認者 | 変更内容 |
|------|------|--------|----------|
| 1.0 | 2026-01-03 | Claude | 初版作成 |
